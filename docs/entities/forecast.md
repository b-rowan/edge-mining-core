# Forecast Entity

## Description

The `Forecast` entity represents a comprehensive energy production prediction for the Edge Mining system. It contains detailed forecasting data organized in time intervals, providing the system with the ability to predict future energy availability and plan mining operations accordingly. This entity aggregates multiple forecast intervals and provides intelligent methods to extract specific predictions for different time horizons.

## Properties

| Property    | Description                                                                                                                                 |
| :---------- | :------------------------------------------------------------------------------------------------------------------------------------------ |
| `timestamp` | The timestamp when this forecast was generated or last updated.                                                                             |
| `intervals` | A list of `ForecastInterval` sub-entities containing detailed predictions for specific time periods with power points and energy estimates. |

## Sub-Entities

The `Forecast` entity encapsulates several sub-entities that provide structured forecasting data:

- **`ForecastInterval`**: Represents a specific time period with detailed energy predictions, containing:

  - `start` and `end` timestamps defining the forecast period
  - `energy` (total predicted energy production for the interval)
  - `energy_remaining` (remaining energy available in the interval)
  - `power_points` (list of `ForecastPowerPoint` sub-entities with timestamped power predictions)
  - Computed properties for `duration` and `avg_power`

- **`ForecastPowerPoint`**: Represents a single prediction point containing:

  - `timestamp` (specific time for the prediction)
  - `power` (predicted power output at that time in Watts)

- **`Sun`**: Contains astronomical data for solar forecasting including:
  - Solar position data (`dawn`, `sunrise`, `noon`, `sunset`, `dusk`)
  - Daylight duration calculations (`daylight`, `night`, `twilight`)
  - Solar geometry data (`azimuth`, `zenith`, `elevation`)
  - Time-based properties for sunrise/sunset calculations

## Relationships

- **Generated by `ForecastProvider`**: Each `Forecast` is produced by a `ForecastProvider` that fetches prediction data from external services.
- **Used by Optimization Services**: The forecast data is consumed by the system's optimization algorithms to plan mining operations based on predicted energy availability.
- **Contains `ForecastInterval` sub-entities**: Multiple time-based forecast intervals that provide granular predictions.
- **Integrates `Sun` data**: For solar energy sources, incorporates astronomical calculations to enhance prediction accuracy.

## Key Operations

- **`next_hour_power`**: Returns the forecasted power output for the next hour based on available forecast intervals.
- **`avg_next_4_hours_power`**: Calculates the average predicted power over the next 4 hours for medium-term planning.
- **`next_hour_energy`**: Provides the total energy expected to be produced in the next hour.
- **`sort_intervals()`**: Organizes forecast intervals and their power points in chronological order.
- **`get_power_at_time(time)`**: Retrieves the forecasted power at a specific timestamp, using linear interpolation between available data points when necessary.
- **`get_energy_over_interval(start, end)`**: Calculates the total predicted energy production over a custom time interval by analyzing overlapping forecast periods.

## Data Processing Capabilities

The `Forecast` entity provides advanced data processing features:

- **Linear Interpolation**: When exact time matches aren't available, the system interpolates between nearby power points to provide accurate predictions.
- **Interval Overlap Calculation**: For custom time ranges, the system calculates energy production by analyzing overlapping forecast intervals and proportionally distributing energy estimates.
- **Time-based Aggregation**: Automatic calculation of average power values and total energy estimates across different time horizons.
- **Chronological Organization**: Automatic sorting of forecast data to ensure consistent time-series processing.

This entity serves as the central hub for all energy production predictions, enabling the Edge Mining system to make informed decisions about when to operate mining equipment based on forecasted energy availability.
